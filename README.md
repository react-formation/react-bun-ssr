# react-bun-ssr

`react-bun-ssr` is a TypeScript-first SSR React framework built for Bun.

Documentation: https://react-bun-ssr.fly.dev/docs/getting-started/introduction

This repository contains both:
- The framework implementation (`framework/**`, `bin/**`).
- The official documentation site built with the framework itself (`app/**`).

## Project layout

- `framework/`: runtime, router, renderer, build tooling, and CLI internals.
- `bin/rbssr.ts`: CLI entrypoint.
- `app/`: docs web app routes, layouts, middleware, and styles.
- `app/routes/docs/**/*.md`: hand-authored markdown docs routes.
- `app/routes/docs/_sidebar.ts`: docs navigation source of truth.
- `app/routes/docs/api/*.md`: generated API docs.
- `app/routes/docs/search-index.json`: generated search index.
- `tests/`: unit + integration tests.
- `e2e/`: Playwright end-to-end tests.

## Requirements

- Bun `>= 1.3.9`
- macOS/Linux (or equivalent Bun-supported environment)

## Runtime API policy

- Prefer Bun APIs for file content I/O, hashing, build, and runtime operations.
- `node:path` is intentionally retained for robust path resolution behavior.
- `node:fs` is retained only for `watch` usage in dev mode.

## Run locally

Install dependencies:

```bash
bun install
```

Run docs site in development:

```bash
bun run docs:dev
```

Open:

```text
http://127.0.0.1:3000
```

Build production artifacts:

```bash
bun run docs:build
```

Start production server:

```bash
bun run docs:preview
```

## Useful commands

Framework:

```bash
bun run dev
bun run build
bun run start
bun run typecheck
bun run test
```

Docs:

```bash
bun run docs:dev
bun run docs:check
bun run docs:build
bun run docs:preview
```

## Generated files

Do not hand-edit generated docs artifacts:
- `app/routes/docs/api/*.md`
- `app/routes/docs/search-index.json`

They are regenerated by:
- `bun run scripts/generate-api-docs.ts`
- `bun run scripts/build-search-index.ts`
- or automatically via `bun run docs:build`

## Collaboration guide

### 1. Create a branch

```bash
git checkout -b feat/<short-description>
```

### 2. Make changes

- Framework code: update `framework/**`.
- Docs content: update `app/routes/docs/**/*.md`.
- Nav changes: update `app/routes/docs/_sidebar.ts`.
- If exports change, regenerate API docs/search index.

### 3. Validate before pushing

```bash
bun run test
bun run docs:check
bun run docs:build
```

### 4. Commit with generated artifacts when needed

If your changes affect API docs or search corpus, commit updated files under `app/routes/docs/api/*.md` and `app/routes/docs/search-index.json`.

### 5. Open a PR

Include:
- Problem statement.
- Approach and tradeoffs.
- Testing performed.
- Screenshots/GIF for docs UI changes (if relevant).

## CI contract

CI runs:
- `bun run test:unit`
- `bun run test:integration`
- `bun run docs:check`
- `bun run docs:build`

`docs:check` fails when docs metadata, links, or generated artifacts are stale.

E2E (`bun run test:e2e`) runs on `push` to `main` only.

## Deploy to Fly.io

### Prerequisites

- Install `flyctl`: https://fly.io/docs/hands-on/install-flyctl/
- Login:

```bash
fly auth login
```

### One-time setup

`fly.toml` is included in this repository. Update the `app` name if needed:

- `fly.toml`

Initialize without deploying (optional):

```bash
fly launch --no-deploy
```

### Deploy

```bash
fly deploy
```

### Validate deployment

```bash
fly status
fly logs
```

Open:

```text
https://<your-fly-app>.fly.dev/docs/getting-started/introduction
```

### Rollback

```bash
fly releases
fly deploy --image <image-ref-from-release>
```

### Scaling (optional)

```bash
fly scale vm shared-cpu-1x
```

### Optional CI deploy

The workflow includes an optional `deploy-fly` job on `main` push.  
Set this repository secret before enabling production deploys:

- `FLY_API_TOKEN`
